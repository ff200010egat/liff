<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏£‡∏ñ ‡∏´‡∏Å-‡∏°‡∏ô.</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body { font-family: system-ui; background:#f4f6f8; margin:0; }
.container { padding:16px; }
.card { background:#fff; border-radius:14px; padding:16px; margin-bottom:14px; }
button { width:100%; padding:16px; font-size:16px; border-radius:12px; border:none; margin-top:10px; }
.primary { background:#0a7cff; color:#fff; font-size:18px; }
.secondary { background:#e0e0e0; }
input,select { width:100%; padding:14px; margin-top:10px; font-size:16px; border-radius:10px; }
.hidden { display:none; }
</style>
</head>

<body>
<div class="container">

<div class="card">
  <h2>üöó ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏£‡∏ñ ‡∏´‡∏Å-‡∏°‡∏ô.</h2>
  <div id="userName"></div>
  <div id="userRole"></div>
</div>

<div class="card">
  <button id="mainBtn" class="primary"></button>
  <button id="historyBtn" class="secondary hidden">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
  <button id="driverBtn" class="secondary hidden">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</button>
</div>

<div class="card hidden" id="bookingForm">
  <h3>‡∏à‡∏≠‡∏á‡∏£‡∏ñ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö</h3>
  <input type="date" id="bookingDate">
  <input type="time" id="bookingTime">
  <select id="vehicleType">
    <option>‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
    <option>‡∏£‡∏ñ‡πÄ‡∏Å‡πã‡∏á</option>
    <option>‡∏£‡∏ñ‡∏Å‡∏£‡∏∞‡∏ö‡∏∞</option>
    <option>‡∏£‡∏ñ‡∏ï‡∏π‡πâ</option>
  </select>
  <input type="number" id="passengerCount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£">
  <input type="text" id="pickupLocation" placeholder="‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö">
  <input type="text" id="dropoffLocation" placeholder="‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á">
  <input type="tel" id="contactMobile" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô">
  <button class="primary" onclick="submitBooking()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
</div>

</div>

<script>
const LIFF_ID = "2008934745-qU0fPztf";
const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbzVDHjQwF1DqVHF5v8hNyUYV590HDamwDlkS0b0rKlvjiLCegk5jZBlzsJ6W1l7_-l6mw/exec";
let userId="", role="";

async function init() {
  await liff.init({ liffId: LIFF_ID });
  if(!liff.isLoggedIn()) liff.login();

  const p = await liff.getProfile();
  userId = p.userId;
  userName.innerText = p.displayName;

  const r = await fetch(GAS_ENDPOINT,{
    method:"POST",
    body:JSON.stringify({
      action:"auto_register",
      line_user_id:userId,
      display_name:p.displayName
    })
  }).then(r=>r.json());

  role = r.role;
  userRole.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + (role==="driver"?"‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ":"‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ");

  mainBtn.innerText = role==="driver" ? "‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" : "‡∏à‡∏≠‡∏á‡∏£‡∏ñ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö";
  if(role!=="driver") historyBtn.classList.remove("hidden");

  mainBtn.onclick = ()=> bookingForm.classList.remove("hidden");
}

async function submitBooking(){
  await fetch(GAS_ENDPOINT,{
    method:"POST",
    body:JSON.stringify({
      action:"create_booking",
      line_user_id:userId,
      booking_date:bookingDate.value,
      booking_time:bookingTime.value,
      vehicle_type:vehicleType.value,
      passenger_count:passengerCount.value,
      pickup_location:pickupLocation.value,
      dropoff_location:dropoffLocation.value,
      contact_mobile:contactMobile.value
    })
  });
  alert("‡∏à‡∏≠‡∏á‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
  bookingForm.classList.add("hidden");
}

init();
</script>
</body>
</html>
