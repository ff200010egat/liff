<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body {
  font-family: sans-serif;
  padding: 16px;
}
h1 { font-size: 24px; margin-bottom: 8px; }
.big-btn {
  width: 100%;
  padding: 18px;
  font-size: 20px;
  margin-bottom: 12px;
}
.btn {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-bottom: 10px;
}
.hidden { display: none; }
</style>
</head>

<body>
<h1>ระบบจองรถ หก-มน.</h1>
<div id="username"></div>
<div id="role"></div>

<button class="big-btn" id="mainBtn"></button>
<button class="btn" id="secondBtn"></button>

<button class="btn" id="registerDriverBtn">ลงทะเบียนเป็นพนักงานขับรถ</button>
<button class="btn hidden" id="cancelDriverBtn">ยกเลิกสถานะพนักงานขับรถ</button>

<div id="bookingForm" class="hidden">
  <input type="date" id="bDate"><br>
  <input type="time" id="bTime"><br>
  <select id="vehicle">
    <option>ไม่ระบุ</option>
    <option>รถเก๋ง</option>
    <option>รถกระบะ</option>
    <option>รถตู้</option>
  </select><br>
  <input placeholder="จำนวนผู้โดยสาร" id="passenger"><br>
  <input placeholder="ต้นทาง / จุดรับ" id="pickup"><br>
  <input placeholder="ปลายทาง / จุดส่ง" id="dropoff"><br>
  <input placeholder="เบอร์มือถือผู้ประสานงาน" id="contact"><br>
  <button onclick="submitBooking()">ยืนยันจอง</button>
</div>

<div id="list"></div>

<script>
const GAS = "PUT_YOUR_GAS_ENDPOINT_HERE";
let profile = {};

async function post(data){
  const r = await fetch(GAS,{method:"POST",body:JSON.stringify(data)});
  return r.json();
}

async function init(){
  await liff.init({ liffId: "2008934745-qU0fPztf" });
  if(!liff.isLoggedIn()) liff.login();

  profile = await liff.getProfile();
  document.getElementById("username").innerText = profile.displayName;

  await post({
    action:"auto_register",
    line_user_id: profile.userId,
    display_name: profile.displayName
  });

  // สมมุติดึง role จาก backend จริง (simplify)
  const role = "user"; // ปรับตาม response จริงได้
  document.getElementById("role").innerText =
    role === "driver" ? "พนักงานขับรถ" : "ผู้ใช้งานทั่วไป";

  if(role === "driver"){
    mainBtn.innerText = "งานทั้งหมด";
    secondBtn.classList.add("hidden");
    cancelDriverBtn.classList.remove("hidden");
  } else {
    mainBtn.innerText = "จองรถพร้อมคนขับ";
    secondBtn.innerText = "ดูประวัติการจอง";
  }
}

function submitBooking(){
  post({
    action:"create_booking",
    line_user_id: profile.userId,
    booking_date: bDate.value,
    booking_time: bTime.value,
    vehicle_type: vehicle.value,
    passenger_count: passenger.value,
    pickup_location: pickup.value,
    dropoff_location: dropoff.value,
    contact_mobile: contact.value
  }).then(()=>alert("จองสำเร็จ"));
}

init();
</script>
</body>
</html>
