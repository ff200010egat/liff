<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body { font-family: system-ui; padding:16px; background:#fafafa; }
h2 { font-size:26px; margin-bottom:6px; }
#username { font-size:20px; }
#role { font-size:18px; color:#555; margin-bottom:16px; }

button {
  width:100%;
  padding:16px;
  font-size:18px;
  border-radius:10px;
  border:none;
  margin-bottom:10px;
}
.primary { background:#0a7cff; color:#fff; }
.secondary { background:#e0e0e0; }
.danger { background:#e53935; color:#fff; }

input, select {
  width:100%;
  padding:12px;
  font-size:16px;
  margin-bottom:8px;
  border-radius:8px;
  border:1px solid #ccc;
}

#formBox, #historyBox { display:none; }
</style>
</head>

<body>

<h2>ระบบจองรถ หก-มน.</h2>
<div id="username"></div>
<div id="role"></div>

<button id="mainBtn" class="primary"></button>
<button id="subBtn" class="secondary"></button>

<div id="driverBox"></div>

<div id="formBox">
  <h3 id="formTitle">ฟอร์มจองรถ</h3>

  <input type="date" id="booking_date">
  <input type="time" id="booking_time">

  <select id="vehicle_type">
    <option value="">-- เลือกรถ --</option>
    <option value="ไม่ระบุ">ไม่ระบุ</option>
    <option value="รถเก๋ง">รถเก๋ง</option>
    <option value="รถกระบะ">รถกระบะ</option>
    <option value="รถตู้">รถตู้</option>
  </select>

  <input type="number" id="passenger_count" placeholder="จำนวนผู้โดยสาร">
  <input type="text" id="pickup_location" placeholder="จุดรับ">
  <input type="text" id="dropoff_location" placeholder="จุดส่ง">
  <input type="text" id="contact_mobile" placeholder="เบอร์ติดต่อ">

  <button class="primary" onclick="submitBooking()">บันทึก</button>
  <button class="secondary" onclick="closeForm()">ยกเลิก</button>
</div>

<div id="historyBox"></div>

<script>
const ENDPOINT = "https://script.google.com/macros/s/AKfycbw0jHGbDnPhOqE8NaqymxvdY0vuq0XaNVA8pqWBgu2zT4dhqNN4J1CvDPjIaJwWVJLgWg/exec";

const mainBtn = document.getElementById("mainBtn");   // ✅ FIX
const subBtn  = document.getElementById("subBtn");    // ✅ FIX

let userId = "";
let role = "";
let mobile = "";
let displayName = "";

async function init() {
  await liff.init({ liffId:"2008934745-qU0fPztf" });
  if (!liff.isLoggedIn()) liff.login();

  const p = await liff.getProfile();
  userId = p.userId;
  displayName = p.displayName;
  document.getElementById("username").innerText = displayName;

  const res = await fetch(ENDPOINT,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      action:"auto_register",
      line_user_id:userId,
      display_name:displayName
    })
  }).then(r=>r.json());

  role = res.role;
