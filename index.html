<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏£‡∏ñ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body {
  font-family: system-ui;
  background: #f2f4f7;
  margin: 0;
}
.container {
  max-width: 480px;
  margin: auto;
  padding: 16px;
}
button {
  width: 100%;
  border: none;
  border-radius: 14px;
  font-size: 1.1rem;
  padding: 16px;
  margin-top: 12px;
}
.primary {
  background: #00b900;
  color: white;
  font-size: 1.3rem;
  padding: 22px;
}
.secondary {
  background: white;
  border: 1px solid #ccc;
}
.card {
  background: white;
  padding: 16px;
  border-radius: 16px;
  margin-top: 16px;
}
.hidden { display: none; }
input {
  width: 100%;
  padding: 14px;
  font-size: 1rem;
  margin-top: 8px;
}
</style>
</head>

<body>
<div class="container">

  <!-- MAIN -->
  <button class="primary">üöó ‡∏à‡∏≠‡∏á‡∏£‡∏ñ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö</button>

  <button class="secondary">üìú ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>

  <div class="card">
    <div id="driverSection"></div>
  </div>

</div>

<script>
const LIFF_ID = "2008934745-qU0fPztf";
const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbz9i-KrKC7o4RFyn7bOV9wAP6oox-CWiMFtBZDfy7IsovT9u3sJ0fhknOYPc9pMM4Fhtw/exec";

let userId = "";
let role = "";
let mobile = "";

async function init() {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) liff.login();

  const profile = await liff.getProfile();
  userId = profile.userId;

  const res = await fetch(GAS_ENDPOINT, {
    method: "POST",
    headers: {"Content-Type":"text/plain"},
    body: JSON.stringify({
      action: "auto_register",
      line_user_id: userId,
      display_name: profile.displayName
    })
  });

  const data = await res.json();
  role = data.role;
  mobile = data.mobile;

  renderDriverUI();
}

function renderDriverUI() {
  const el = document.getElementById("driverSection");

  if (role !== "driver") {
    el.innerHTML = `
      <button onclick="registerDriver()">üßë‚Äç‚úàÔ∏è ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</button>
    `;
  } else {
    el.innerHTML = `
      <div>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${mobile}</div>
      <button onclick="registerDriver()">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</button>
    `;
  }
}

async function registerDriver() {
  const phone = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)");
  if (!phone) {
    alert("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠");
    return;
  }

  const res = await fetch(GAS_ENDPOINT, {
    method: "POST",
    headers: {"Content-Type":"text/plain"},
    body: JSON.stringify({
      action: "register_driver",
      line_user_id: userId,
      mobile_phone: phone
    })
  });

  const data = await res.json();
  if (data.success) {
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    location.reload();
  }
}

init();
</script>
</body>
</html>
